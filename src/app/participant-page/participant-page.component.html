<ng-container *ngIf="showMedicalRecord">
  <app-medical-record [participant]="participant" [medicalRecord]="medicalRecord" [settings]="settings"
                      [mrCoverPdfSettings]="mrCoverPdfSettings"
                      (leaveMedicalRecord)="showMedicalRecord=false"
                      (leaveParticipant)="leavePage()"></app-medical-record>
</ng-container>

<ng-container *ngIf="showTissue">
  <app-tissue-page [participant]="participant" [oncHistoryDetail]="oncHistoryDetail"
                   [settings]="settings"
                   (leaveTissue)="showTissue=false" (leaveParticipant)="leavePage()"></app-tissue-page>
</ng-container>

<ng-container *ngIf="!showMedicalRecord && !showTissue">
  <h1> Participant Page </h1>

  <div *ngIf="errorMessage != null">
    <h3 class="Color--warn">{{errorMessage}}</h3>
    <br/>
  </div>

  <div *ngIf="additionalMessage != null">
    <h3 class="Color--warn Line--Break">{{additionalMessage}}</h3>
    <br/>
  </div>


  
  <div *ngIf="errorMessage == null" class="Width--100">
    
    <br/>
    <a href="#" (click)="leavePage()"><b> << back to 'List' </b></a>
    <br/><br/><br/>
    
    <span [hidden]="!loadingParticipantPage && !updatingParticipant" class="Width--100">
      <div align="center" class="Width--100 Height--100">
        <i class="fas fa-spinner fa-spin fa-5x Color--primary"></i>
      </div>
    </span>
    
    
    <div *ngIf="!loadingParticipantPage && !updatingParticipant" class="Width--100">

      <div *ngIf="participantExited">
        <h3 class="Color--warn Line--Break">Participant was withdrawn from the study!</h3>
        <br/>
      </div>
      <div *ngIf="participantNotConsented">
        <h3 class="Color--warn Line--Break">Lost to Follow-Up</h3>
        <br/>
      </div>

      <div class="Float--left" *ngIf="participant.data != null">
        <table class="table table-condensed">
          <tbody>
          <tr *ngIf="participant.data.status != null">
            <td>Status</td>
            <td>{{participant.data.status | buttonSelect}}</td>
          </tr>
          <tr *ngIf="participant.data.profile['createdAt'] != null">
            <td>Registration Date</td>
            <td>{{participant.data.profile['createdAt']| date:'medium'}}</td>
          </tr>
          <tr *ngIf="participant.data.profile['hruid'] != null">
            <td>Short ID</td>
            <td>{{participant.data.profile['hruid']}}</td>
          </tr>
          <tr
            *ngIf="participant.data.profile['legacyShortId'] != null && participant.data.profile['legacyShortId'] !== ''">
            <td>Legacy Short ID</td>
            <td>{{participant.data.profile['legacyShortId']}}</td>
          </tr>
          <tr *ngIf="participant.data.profile['guid'] != null">
            <td>Internal Participant ID</td>
            <td>{{participant.data.profile['guid']}}</td>
          </tr>
          <tr
            *ngIf="participant.data.profile['legacyAltPid'] != null && participant.data.profile['legacyAltPid'] !== ''">
            <td>Legacy Participant ID</td>
            <td>{{participant.data.profile['legacyAltPid']}}</td>
          </tr>
          <tr>
            <td>First Name</td>
            <td *ngIf="hasRole().allowedToEditParticipant()">
              <input mdInput type="text" maxlength="200" autocomplete="off" placeholder="First Name"
                    [(ngModel)]="updatedFirstName"
                    class="update-participant-input">
              <button md-raised-button color="primary"
                      (click)="updateFirstName()"
                      [disabled]="updatedFirstName === participant.data.profile['firstName'] || updatedFirstName.length == 0"
                      >Update
              </button>
            </td>
            <td *ngIf="!hasRole().allowedToEditParticipant()">
              {{participant.data.profile['firstName']}}
            </td>
          </tr>
          <tr>
            <td>Last Name</td>
            <td *ngIf="hasRole().allowedToEditParticipant()">
              <input mdInput type="text" maxlength="200" autocomplete="off" placeholder="Last Name"
                  [(ngModel)]="updatedLastName"
                  class="update-participant-input">
              <button md-raised-button color="primary"
                      [disabled]="updatedLastName === participant.data.profile['lastName'] || updatedLastName.length == 0"
                      (click)="updateLastName()">Update
              </button>
            </td>
            <td *ngIf="!hasRole().allowedToEditParticipant()">
              {{participant.data.profile['lastName']}}
            </td>
          </tr>
          <tr>
            <td>E-Mail</td>
            <td *ngIf="hasRole().allowedToEditParticipant()">
              <span *ngIf="isEmailValid == false" class="invalid-email">E-Mail is not valid</span>
              <input mdInput type="email" maxlength="200" autocomplete="off" placeholder="Email"
              [ngModel]="updatedEmail"
              (ngModelChange)="validateEmailInput($event)"
              email
              class="update-participant-input">
              <button md-raised-button color="primary"
              [disabled]="updatedEmail === participant.data.profile['email'] || updatedEmail.length == 0 || isEmailValid == false"
              (click)="updateEmail()">Update
            </button>
          </td>
          <td *ngIf="!hasRole().allowedToEditParticipant()">
            {{participant.data.profile['email']}}
          </td>
          </tr>
          <tr>
            <td>Date of Birth</td>
            <td>{{getUtil().getDateFormatted(participant.data.dsm['dateOfBirth'])}}</td>
          </tr>
          <tr *ngIf="participant.data.dsm != null && participant.data.dsm['dateOfMajority'] != null">
            <td>Date of Majority</td>
            <td>{{getUtil().getDateFormatted(participant.data.dsm['dateOfMajority'])}}</td>
          </tr>
          <tr *ngIf="participant.data.dsm != null && (participant.data.dsm['diagnosisMonth'] != null ||
          participant.data.dsm['diagnosisYear'] != null)">
            <td>Date of Diagnosis</td>
            <td>
              <ng-container *ngIf="participant.data.dsm != null && participant.data.dsm['diagnosisMonth'] != null &&
participant.data.dsm['diagnosisYear'] != null">
                {{participant.data.dsm['diagnosisMonth']}}/{{participant.data.dsm['diagnosisYear']}}
              </ng-container>
              <ng-container *ngIf="participant.data.dsm != null && participant.data.dsm['diagnosisMonth'] != null &&
participant.data.dsm['diagnosisYear'] == null">
                {{participant.data.dsm['diagnosisMonth']}}/null
              </ng-container>
              <ng-container *ngIf="participant.data.dsm != null && participant.data.dsm['diagnosisMonth'] == null &&
participant.data.dsm['diagnosisYear'] != null">
                {{participant.data.dsm['diagnosisYear']}}
              </ng-container>
            </td>
          </tr>
          <tr *ngIf="participant.medicalRecords != null && participant.medicalRecords.length > 0">
            <td>Consent Tissue</td>
            <td>{{getUtil().getYesNo(getTissueConsent())}}</td>
          </tr>
          <tr *ngIf="participant.medicalRecords != null && participant.medicalRecords.length > 0">
            <td>Consent Blood</td>
            <td>{{getUtil().getYesNo(getBloodConsent())}}</td>
          </tr>
          <tr *ngIf="participant.oncHistoryDetails != null && participant.oncHistoryDetails.length > 0">
            <td>Gender</td>
            <td>{{gender | titlecase}}</td>
          </tr>
          <tr *ngIf="participant.data.profile['preferredLanguage'] != null && participant.data.profile['preferredLanguage'] !== ''">
            <td>Preferred Language</td>
            <td>{{getLanguageName(participant.data.profile['preferredLanguage'])}}</td>
          </tr>
          </tbody>
        </table>

        <div *ngIf="isAddFamilyMember" class="Float--right Width--100">
          <div class="family-member-button">
            <button md-mini-fab color="primary" class="md-fab-bottom-left" (click)="showFamilyMemberPopUpOnClick()">
              +
            </button>
            <span>Add Family Member</span>
          </div>
        </div>
        
        <ng-container *ngIf="participant.proxyData != null && participant.proxyData.length > 0">
          <b>Proxy Data</b>
          <table class="table table-condensed">
            <tbody>
              <ng-container *ngFor="let proxy of participant.proxyData">
                <tr>
                  <td>Name</td>
                  <td>{{proxy.profile['firstName']}} {{proxy.profile['lastName']}}</td>
                </tr>
                <tr *ngIf="proxy.profile['email'] != null">
                  <td>E-Mail</td>
                  <td>{{proxy.profile['email']}}</td>
                </tr>
              </ng-container>
            </tbody>
          </table>
        </ng-container>
        <ng-container *ngIf="participant.data.invitations != null && participant.data.invitations.length > 0">
          <ng-container *ngFor="let invitation of participant.data.invitations">
            <app-invitation-data *ngIf="invitation != null" [invitation]="invitation"></app-invitation-data>
          </ng-container>
        </ng-container>
        <br/>
        <br/>
      </div>
      <div class="Float--left TD--Padding-Left-BIG">
        <!--PDF download-->
        <ng-container *ngIf="participant.participant == null">
          <ng-container *ngIf="pdfs != null && pdfs.length != 0 && hasRole().allowedToDownloadPDF()">
            <md-select placeholder="Select PDF" class="Input--Abstraction" [(ngModel)]="selectedPDF">
              <md-option *ngFor="let e of pdfs" [value]="e.configName">
                {{e.displayName}}
              </md-option>
            </md-select>
            <br/>
            <br/>
            <button md-raised-button color="primary"
                    [disabled]="selectedPDF == null || selectedPDF === '' || disableDownload"
                    (click)="downloadPDFs(selectedPDF)">Download selected PDF
            </button>
          </ng-container>
        </ng-container>

        <!--Abstraction start buttons-->
        <div *ngIf="counterReceived > 0 && parentList === 'participantList'">
          <div class="Float--left TD--Padding">
            <div class="Float--left Width--100">
              <b>First Abstraction</b> <b *ngIf="participant.abstraction.aStatus === 'not_started'"> not started yet</b>
            </div>
            <div class="Float--left" *ngIf="participant.abstraction.aStatus !== 'in_progress' && participant.abstraction.aStatus !== 'done' && participant.abstraction.aStatus !== 'clear'
                  && hasRole().isAbstracter()">
              <button md-raised-button type="button" color="primary" [disabled]="participantExited"
                      (click)="lockParticipant(participant.abstraction)">Start First MR Abstraction
              </button>
            </div>
            <div class="Float--left" *ngIf="participant.abstraction.aStatus === 'clear' && hasRole().isAbstracter()
                  && ((participant.review != null && participant.review.user !== hasRole().getUserName()) || participant.review == null || participant.review.aStatus === 'clear')">
              <button md-raised-button type="button" color="primary" [disabled]="participantExited"
                      (click)="lockParticipant(participant.abstraction)">Continue First MR Abstraction
              </button>
            </div>
            <div class="Float--left Width--100"
                 *ngIf="participant.abstraction.aStatus !== 'not_started' && participant.abstraction.aStatus !== 'clear' && participant.abstraction.lastChanged == 0">
              <b>{{participant.abstraction.user}}</b>
              <b>started: {{participant.abstraction.startDate | date:'medium'}}</b>
            </div>
            <div class="Float--left Width--100"
                 *ngIf="participant.abstraction.aStatus !== 'not_started' && participant.abstraction.aStatus !== 'clear' && participant.abstraction.lastChanged != 0">
              <b>{{participant.abstraction.user}}</b>
              <b>continued: {{participant.abstraction.lastChanged | date:'medium'}}</b>
            </div>
            <div class="Float--left Width--100" *ngIf="participant.abstraction.aStatus === 'clear'">
              <b>{{participant.abstraction.user}}</b>
              <b>broke lock on: {{participant.abstraction.lastChanged | date:'medium'}}</b>
            </div>
            <div class="Float--left Width--100"
                 *ngIf="participant.abstraction.aStatus === 'in_progress' && hasRole().isAbstractionAdmin()">
              <button md-raised-button type="button" color="primary" [disabled]="participantExited"
                      (click)="breakLockParticipant(participant.abstraction)">Un-lock First MR Abstraction
              </button>
            </div>
            <div class="Float--left Width--100" *ngIf="participant.abstraction.aStatus === 'done'">
              <b>Finished: {{participant.abstraction.lastChanged | date:'medium'}}</b>
            </div>
          </div>
        </div>

        <div
          *ngIf="participant.abstraction != null && (participant.abstraction.aStatus === 'in_progress' || participant.abstraction.aStatus === 'done' || participant.abstraction.aStatus === 'clear')
             && parentList === 'participantList'">
          <div class="Float--left TD--Padding">
            <div class="Float--left Width--100">
              <b>Second Abstraction</b> <b *ngIf="participant.review.aStatus === 'not_started'"> not started yet</b>
            </div>
            <div class="Float--left" *ngIf="participant.review.aStatus !== 'in_progress' && participant.review.aStatus !== 'done' && participant.review.aStatus !== 'clear'
                   && participant.abstraction.user !== hasRole().getUserName() && hasRole().isAbstracter()">
              <button md-raised-button type="button" color="primary" [disabled]="participantExited"
                      (click)="lockParticipant(participant.review)">Start Second MR Abstraction
              </button>
            </div>
            <div class="Float--left" *ngIf="participant.review.aStatus === 'clear' && hasRole().isAbstracter()
                   && (participant.abstraction.user !== hasRole().getUserName() || participant.abstraction.aStatus === 'clear')">
              <button md-raised-button type="button" color="primary" [disabled]="participantExited"
                      (click)="lockParticipant(participant.review)">Continue Second MR Abstraction
              </button>
            </div>
            <div class="Float--left Width--100"
                 *ngIf="participant.review.aStatus !== 'not_started' && participant.review.aStatus !== 'clear' && participant.review.lastChanged == 0">
              <b>{{participant.review.user}}</b>
              <b>started: {{participant.review.startDate | date:'medium'}}</b>
            </div>
            <div class="Float--left Width--100"
                 *ngIf="participant.review.aStatus !== 'not_started' && participant.review.aStatus !== 'clear' && participant.review.lastChanged != 0">
              <b>{{participant.review.user}}</b>
              <b>continued: {{participant.review.lastChanged | date:'medium'}}</b>
            </div>
            <div class="Float--left Width--100" *ngIf="participant.review.aStatus === 'clear'">
              <b>{{participant.review.user}}</b>
              <b>broke lock on: {{participant.review.lastChanged | date:'medium'}}</b>
            </div>
            <div class="Float--left Width--100"
                 *ngIf="participant.review.aStatus === 'in_progress' && hasRole().isAbstractionAdmin()">
              <button md-raised-button type="button" color="primary" [disabled]="participantExited"
                      (click)="breakLockParticipant(participant.review)">Un-lock Second MR Abstraction
              </button>
            </div>
            <div class="Float--left Width--100" *ngIf="participant.review.aStatus === 'done'">
              <b>Finished: {{participant.review.lastChanged | date:'medium'}}</b>
            </div>
          </div>
        </div>

        <!--tie breaker is only able to start when abstraction and review are done-->
        <div
          *ngIf="participant.abstraction != null && participant.abstraction.aStatus === 'done' && participant.review != null && participant.review.aStatus === 'done'
           && parentList === 'participantList'">
          <div class="Float--left TD--Padding">
            <div class="Float--left Width--100">
              <b>QC</b> <b *ngIf="participant.qc.aStatus === 'not_started'"> not started yet</b>
            </div>
            <div class="Float--left" *ngIf="participant.qc.aStatus !== 'in_progress' && participant.qc.aStatus !== 'done' && participant.qc.aStatus !== 'clear'
                    && participant.abstraction.user !== hasRole().getUserName() && participant.review.user !== hasRole().getUserName()
                    && hasRole().isQC()">
              <button md-raised-button type="button" color="primary" [disabled]="participantExited"
                      (click)="lockParticipant(participant.qc)">Start QC
              </button>
            </div>
            <div class="Float--left" *ngIf="participant.qc.aStatus === 'clear'
                  && hasRole().isAbstracter()">
              <button md-raised-button type="button" color="primary" [disabled]="participantExited"
                      (click)="lockParticipant(participant.qc)">Continue QC
              </button>
            </div>
            <div class="Float--left Width--100"
                 *ngIf="participant.qc.aStatus !== 'not_started' && participant.qc.aStatus !== 'clear'">
              <b>{{participant.qc.user}}</b>
              <b>started: {{participant.qc.startDate | date:'medium'}}</b>
            </div>
            <div class="Float--left Width--100" *ngIf="participant.qc.aStatus === 'clear'">
              <b>{{participant.qc.user}}</b>
              <b>broke lock on: {{participant.qc.lastChanged | date:'medium'}}</b>
            </div>
            <div class="Float--left Width--100"
                 *ngIf="participant.qc.aStatus === 'in_progress' && hasRole().isAbstractionAdmin()">
              <button md-raised-button type="button" color="primary" [disabled]="participantExited"
                      (click)="breakLockParticipant(participant.qc)">Un-lock QC
              </button>
            </div>
            <div class="Float--left Width--100" *ngIf="participant.qc.aStatus === 'done'">
              <b>Finished: {{participant.qc.lastChanged | date:'medium'}}</b>
            </div>
          </div>
        </div>
      </div>
      <br/>
      <div class="Float--left Width--100" *ngIf="participant.participant != null">
        <table class="Width--100">
          <tr *ngIf="participant.medicalRecords != null && participant.medicalRecords.length > 0">
            <td class="Width--20">Participant Notes</td>
            <td class="Width--80">
            <textarea maxlength="1000" [disabled]="participantExited"
                      [ngClass]="{'Width--100': true, 'Color--Field--Patched': isPatchedCurrently('ptNotes')}"
                      (blur)="currentField(null)" (focus)="currentField('ptNotes')"
                      [(ngModel)]="participant.participant.ptNotes"
                      (change)="valueChanged($event, 'ptNotes', 'r')"></textarea>
            </td>
          </tr>
          <ng-container *ngIf="showParticipantRecord">
            <tr *ngIf="participant.medicalRecords != null && participant.medicalRecords.length > 0">
              <td>Paper C/R Sent</td>
              <td>
                <div class="Float--left">
                  <app-field-datepicker [dateString]="participant.participant.paperCRSent"
                                        [disabled]="participantExited"
                                        [colorDuringPatch]="isPatchedCurrently('paperCRSent')"
                                        (dateChanged)="valueChanged($event, 'paperCRSent', 'r')"></app-field-datepicker>
                </div>
                <div *ngIf="participant.participant.paperCRSent != null" class="Float--left Router--Outlet">Paper C/R
                  Received
                  <app-field-datepicker [dateString]="participant.participant.paperCRReceived"
                                        [disabled]="participantExited"
                                        [colorDuringPatch]="isPatchedCurrently('paperCRReceived')"
                                        (dateChanged)="valueChanged($event, 'paperCRReceived', 'r')"></app-field-datepicker>
                </div>
              </td>
            </tr>
          </ng-container>
          <tr *ngIf="participant.medicalRecords != null && participant.medicalRecords.length > 0">
            <td>Onc History Created</td>
            <td>
              <div class="Float--left">
                <app-field-datepicker [dateString]="participant.participant.createdOncHistory"
                                      [disabled]="participantExited"
                                      [colorDuringPatch]="isPatchedCurrently('createdOncHistory')"
                                      (dateChanged)="valueChanged($event, 'createdOncHistory', 'o')"></app-field-datepicker>
              </div>
              <div *ngIf="participant.participant.createdOncHistory != null" class="Float--left Router--Outlet">Onc
                History Reviewed
                <app-field-datepicker [dateString]="participant.participant.reviewedOncHistory"
                                      [disabled]="participantExited"
                                      [colorDuringPatch]="isPatchedCurrently('reviewedOncHistory')"
                                      (dateChanged)="valueChanged($event, 'reviewedOncHistory', 'o')"></app-field-datepicker>
              </div>
            </td>
          </tr>
          <tr *ngIf="participant.medicalRecords != null && participant.medicalRecords.length > 0">
            <td>
              Incomplete/Minimal Medical Records
            </td>
            <td>
              <md-checkbox color="primary" [disabled]="participantExited"
                           [ngClass]="{'Width--100': true, 'Color--Field--Patched': isPatchedCurrently('minimalMR')}"
                           [(ngModel)]="participant.participant.minimalMR"
                           (change)="valueChanged($event, 'minimalMR', 'r')"
                           disableRipple>
              </md-checkbox>
            </td>
          </tr>
          <tr *ngIf="participant.medicalRecords != null && participant.medicalRecords.length > 0">
            <td>
              Ready for Abstraction
            </td>
            <td>
              <md-checkbox color="primary" [disabled]="participantExited"
                           [ngClass]="{'Width--100': true, 'Color--Field--Patched': isPatchedCurrently('abstractionReady')}"
                           [(ngModel)]="participant.participant.abstractionReady"
                           (change)="valueChanged($event, 'abstractionReady', 'r')"
                           disableRipple>
              </md-checkbox>
            </td>
          </tr>
          <ng-container *ngIf="settings['r'] != null">
            <tr *ngFor="let fieldSetting of settings['r']">
              <td>{{fieldSetting.columnDisplay}}</td>
              <td>
                <br/>
                <md-input-container
                  *ngIf="fieldSetting.displayType === 'TEXT' || fieldSetting.displayType === ''|| fieldSetting.displayType == null"
                  [ngClass]="{'Width--100': true, 'Input--Min-WIDTH': true, 'Color--Field--Patched': isPatchedCurrently(fieldSetting.columnName)}">
                  <input mdInput maxlength="200" [disabled]="participantExited"
                         value="{{getAdditionalValue(fieldSetting.columnName)}}"
                         placeholder="{{fieldSetting.columnDisplay}}"
                         (change)="onAdditionalValueChange($event, fieldSetting.columnName)"
                         (blur)="currentField(null)" (focus)="currentField(fieldSetting.columnName)">
                </md-input-container>
                <md-input-container *ngIf="fieldSetting.displayType === 'NUMBER'"
                                    [ngClass]="{'Input': true, 'Color--Field--Patched': isPatchedCurrently(fieldSetting.columnName)}">
                  <input mdInput maxlength="200" type="number" [disabled]="participantExited"
                         value="{{getAdditionalValue(fieldSetting.columnName)}}"
                         (change)="onAdditionalValueChange($event, fieldSetting.columnName)"
                         (blur)="currentField(null)" (focus)="currentField(fieldSetting.columnName)">
                </md-input-container>
                <textarea maxlength="1000" *ngIf="fieldSetting.displayType === 'TEXTAREA'"
                          [ngClass]="{'Width--100': true, 'Color--Field--Patched': isPatchedCurrently(fieldSetting.columnName)}"
                          (blur)="currentField(null)" (focus)="currentField(fieldSetting.columnName)"
                          [disabled]="participantExited"
                          value="{{getAdditionalValue(fieldSetting.columnName)}}"
                          (change)="onAdditionalValueChange($event, fieldSetting.columnName)"></textarea>
                <md-select *ngIf="fieldSetting.displayType === 'OPTIONS'" placeholder="{{fieldSetting.columnDisplay}}"
                           [ngModel]="getAdditionalValue(fieldSetting.columnName)"
                           (change)="onAdditionalValueChange($event, fieldSetting.columnName)"
                           [disabled]="participantExited"
                           [ngClass]="{'Color--Field--Patched': isPatchedCurrently(fieldSetting.columnName)}">
                  <md-option *ngFor="let op of fieldSetting.possibleValues" [value]="op.value">{{op.value}}</md-option>
                </md-select>
                <md-checkbox *ngIf="fieldSetting.displayType === 'CHECKBOX'" color="primary" disableRipple
                             [ngModel]="getAdditionalValue(fieldSetting.columnName)"
                             (change)="onAdditionalValueChange($event, fieldSetting.columnName)"
                             [disabled]="participantExited">
                </md-checkbox>
                <app-field-datepicker *ngIf="fieldSetting.displayType === 'DATE'"
                                      [colorDuringPatch]="isPatchedCurrently(fieldSetting.columnName)"
                                      [disabled]="participantExited"
                                      [dateString]="getAdditionalValue(fieldSetting.columnName)"
                                      (dateChanged)="onAdditionalValueChange($event, fieldSetting.columnName)"></app-field-datepicker>
              </td>
            </tr>
          </ng-container>
        </table>
      </div>

      <div class="Float--left Width--100">
          <!--tab order is not working when tabs have ngIf, will just put them at the end of static tabs. therefore ngIf=true is added to static tabs-->
          
          <my-tabs [participantTabs]="participantTabs">
            <app-form-data [settings]="settings" [participant]="participant"
                          [activityDefinitions]="activityDefinitions"
                          [activeTab]="activeTab"
                          (putTab)="putTab($event)"
                          ></app-form-data>  
            <my-tab tabTitle="second TAB" (putTab)="putTab($event)">
              Tab 2 content
            </my-tab>
          </my-tabs>
      </div>
    </div>
  </div>

  <app-modal>
    <div class="app-modal-header">
      <ng-container *ngIf="!_showWarningModal">
        Note for medical record:
      </ng-container>
      <ng-container *ngIf="_showWarningModal">
        Tissue Request Warning
      </ng-container>
    </div>
    <div class="app-modal-body">
      <ng-container *ngIf="!_showWarningModal">
      <textarea class="Width--100" maxlength="1000" [disabled]="participantExited"
                *ngIf="noteMedicalRecord != null" [(ngModel)]="noteMedicalRecord.mrNotes"></textarea>
      </ng-container>
      <ng-container *ngIf="_showWarningModal">
        {{warning}}
      </ng-container>
    </div>
    <div class="app-modal-footer">
      <button type="button" class="btn btn-default"
              (click)="universalModal.hide()">Cancel
      </button>
      <ng-container *ngIf="!_showWarningModal">
        <button type="button" class="btn btn-primary" [disabled]="participantExited"
                (click)="saveNote()">Save & Close
        </button>
      </ng-container>
      <ng-container *ngIf="_showWarningModal">
        <button type="button" class="btn btn-default" [disabled]="participantExited"
                (click)="doRequest()">Request Anyway
        </button>
      </ng-container>
    </div>
  </app-modal>
</ng-container>
